!function(){"use strict";!function(){var s=L.map("map").setView([25.03819,121.552001],14);L.tileLayer("",{minZoom:14,maxZoom:16,id:"mapbox/streets-v11"}).addTo(s);var o=fetch("https://ptx.transportdata.tw/MOTC/v2/Bus/DisplayStopOfRoute/City/Taipei/307",{method:"GET",headers:function(){var o=(new Date).toGMTString(),t=new jsSHA("SHA-1","TEXT");t.setHMACKey("f-X77D6fPqHMvcJ238NzSIrDX_4","TEXT"),t.update("x-date: "+o);var e=t.getHMAC("B64"),n='hmac username="adb7d309f97440719c9ad8d648ac09a0", algorithm="hmac-sha1", headers="x-date", signature="'+e+'"';return console.log(n),console.log(o),{Authorization:n,"X-Date":o}}()}),t=fetch("api/village.json"),e=fetch("api/district.json");Promise.all([o,t,e]).then(function(o){return Promise.all(o.map(function(o){return o.json()}))}).then(function(o){console.log(o);var t=o[0],e=o[1],n=o[2],i=t[0].Stops.map(function(o){return{StopName:o.StopName.Zh_tw,PositionLat:o.StopPosition.PositionLat,PositionLon:o.StopPosition.PositionLon}});console.log(i);var a=[];e.features.forEach(function(o){"臺北市"!==o.properties.COUNTY&&"新北市"!==o.properties.COUNTY||a.push(o)}),e.features=[],e.features=a;var r=[];n.features.forEach(function(o){"臺北市"!==o.properties.COUNTY&&"新北市"!==o.properties.COUNTY||r.push(o)}),n.features=[],n.features=r,L.geoJSON(e,{color:"#999999",weight:1}).addTo(s),L.geoJSON(n,{color:"#000000",weight:1}).addTo(s),function(o){var t=o.map(function(o,t,e){if(0<t)return[new L.LatLng(e[t-1].PositionLat,e[t-1].PositionLon),new L.LatLng(e[t].PositionLat,e[t].PositionLon)]});t.splice(0,1);for(var e=0;e<t.length;e++){"undefined"!==t[e]&&new L.Polyline(t[e],{color:"red",weight:4,opacity:1,smoothFactor:1}).addTo(s)}}(i),i.forEach(function(o){var t,e,n,i=[o.PositionLat,o.PositionLon];t=i,e=o.StopName,(n=L.circle(t,{stroke:!1,fillColor:"#f03",fillOpacity:.5,radius:100}).addTo(s)).bindPopup("<div>"+e+"</div>"),n.on("mouseover",function(o){n.openPopup()}),n.on("mouseout",function(o){n.closePopup()})})})}()}();